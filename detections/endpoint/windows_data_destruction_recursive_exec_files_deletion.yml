name: Windows Data Destruction Recursive Exec Files Deletion
id: 3596a799-6320-4a2f-8772-a9e98ddb2960
version: 2
date: '2023-03-05'
author: Teoderick Contreras, Splunk, Steven Dick
status: production
type: TTP
description: The following analytic identifies a suspicious process recursively deleting
  files in a compromised host. This behavior was seen in several destructive malware,
  wiper like caddy wiper, doublezero, and now swiftslicer that delete or overwrite
  files with random generated strings to make it unrecoverable. This analytic can
  also catch a possible recursive file write on multiple files using Sysmon Event
  23 or 26. Sysmon treats the modified file as a deleted one as soon as it was overwritten.
  This analytic can be a good indicator that a possible destructive malware is running
  in a host machine or a big software application is being uninstalled.
data_source:
- Sysmon Event ID 23
- Sysmon Event ID 26
search: '`sysmon` EventCode IN ("23","26") TargetFilename IN ("*.exe", "*.sys", "*.dll") 
| bin _time span=2m 
| stats count, values(TargetFilename) as deleted_files, min(_time) as firstTime, max(_time) as lastTime by user, dest, signature, signature_id, Image, process_name, process_guid
| rename Image as process
| where count >=500 
| `security_content_ctime(firstTime)` 
| `security_content_ctime(lastTime)` 
| `windows_data_destruction_recursive_exec_files_deletion_filter`'
how_to_implement: To successfully implement this search, you need to be ingesting logs with the process name, TargetFilename, and ProcessID executions from your endpoints. If you are using Sysmon, you must have at least version 2.0 of the Sysmon TA.
known_false_positives: Uninstall of a large software application or usage of cleanmgr.exe may trigger this detection.
  Filter is needed.
references:
- https://www.welivesecurity.com/2023/01/27/swiftslicer-new-destructive-wiper-malware-ukraine/
tags:
  analytic_story:
  - Swift Slicer
  - Data Destruction
  asset_type: Endpoint
  confidence: 80
  impact: 80
  message: $process_name$ deleted a large number of executable files [$count$] on $dest$
  mitre_attack_id:
  - T1485
  observable:
  - name: user
    type: User
    role:
    - Victim
  - name: dest
    type: Endpoint
    role:
    - Victim
  - name: deleted_files
    type: File Name
    role:
    - Attacker
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - _time
  - Image
  - TargetFilename
  - dest
  - user
  - signature_id
  - process_name
  - process_guid
  risk_score: 64
  security_domain: endpoint
tests:
- name: True Positive Test
  attack_data:
  - data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/malware/swift_slicer/sysmon.log
    source: XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
    sourcetype: xmlwineventlog
    update_timestamp: true
